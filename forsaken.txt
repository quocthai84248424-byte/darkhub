-- DARK HUB V28 - FIX UI NOT LOADING
-- Tích hợp Logic Hutao + Teleport Trước Mặt + Auto Execute

-- 1. TỰ ĐỘNG KÍCH HOẠT AUTO EXECUTE (Ghi nhớ để server sau tự chạy)
pcall(function()
    local qot = queue_on_teleport or (syn and syn.queue_on_teleport)
    if qot then
        qot([[
            task.wait(5)
            loadstring(game:HttpGet("https://raw.githubusercontent.com/hdksakst-ship-it/Hutao-Hub-Omega-X/refs/heads/main/Forsaken-v3.txt"))()
        ]])
    end
end)

-- 2. KHỞI TẠO SETTINGS MẶC ĐỊNH (Tự bật Farm luôn)
getgenv().AutoFarm = true
getgenv().RepairDelay = 1.2
getgenv().AutoHop = true

-- 3. LOAD THƯ VIỆN UI RAYFIELD (Dễ lên nhất)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "DARK HUB V28 | @bacon1607",
   Icon = 0,
   LoadingTitle = "Đang khởi chạy...",
   LoadingSubtitle = "by hieuzed05 & Hannah",
   ConfigurationSaving = { Enabled = false }
})

local MainTab = Window:CreateTab("Main", 4483362458)

local Toggle = MainTab:CreateToggle({
   Name = "Auto Fix Gen (Instant TP)",
   CurrentValue = true,
   Flag = "FarmToggle",
   Callback = function(Value)
      getgenv().AutoFarm = Value
   end,
})

-- 4. IDENTITY LOCK (@bacon1607)
MainTab:CreateButton({
   Name = "Lock Name @bacon1607",
   Callback = function()
      task.spawn(function()
         local n = "bacon1607"
         while task.wait(0.5) do
            pcall(function()
                local p = game.Players.LocalPlayer
                p.DisplayName = n
                p.Name = n
                if p.Character and p.Character:FindFirstChild("Humanoid") then
                    p.Character.Humanoid.DisplayName = n
                end
            end)
         end
      end)
   end,
})

-- 5. LOGIC NHẬN DIỆN MÁY (HUTAO SCANNER)
local function GetTarget()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") then
            local act = v.ActionText:lower()
            local obj = v.ObjectText:lower()
            if act:find("repair") or act:find("fix") or obj:find("gen") then
                local model = v.Parent
                local prog = model:FindFirstChild("Progress") or model:FindFirstChild("Value", true)
                if not prog or (prog and prog.Value < 100) then
                    return {Model = model, Prompt = v, Progress = prog}
                end
            end
        end
    end
    return nil
end

-- 6. THỰC THI TELEPORT TRƯỚC MẶT MÁY
task.spawn(function()
    while true do
        task.wait(0.5)
        if getgenv().AutoFarm then
            local target = GetTarget()
            if target then
                local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    -- Tính toán vị trí trước mặt máy (Offset -3.7)
                    local cf = target.Model:GetModelCFrame()
                    local tpPos = cf * CFrame.new(0, 0, -3.7)

                    -- Teleport tức thời
                    hrp.CFrame = CFrame.new(tpPos.Position, cf.Position)

                    while getgenv().AutoFarm and (not target.Progress or target.Progress.Value < 100) do
                        hrp.CFrame = CFrame.new(tpPos.Position, cf.Position) -- Giữ vị trí
                        fireproximityprompt(target.Prompt)
                        task.wait(getgenv().RepairDelay)
                        if not target.Model:IsDescendantOf(workspace) then break end
                    end
                end
            elseif getgenv().AutoHop then
                task.wait(2)
                game:GetService("TeleportService"):Teleport(game.PlaceId)
            end
        end
    end
end)

Rayfield:Notify({Title = "DARK HUB", Content = "Script nạp thành công!", Duration = 5})
