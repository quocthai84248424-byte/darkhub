--[[
    　　　　　／＞　　フ
    　　　　　| 　_　 _ l
    　 　　　／` ミ＿xノ
    　　 　 /　　　 　 |
    　　　 /　 ヽ　　 ﾉ
    　 　 │　　|　|　|
    　／￣|　　 |　|　|
    　| (￣ヽ＿_ヽ_)__)
    　＼二つ

    DARK HUB - FINAL V8 (VIDEO SYNC)
    AUTHORIZED: hieuzed05 & HannahPrimalMystic
    FIXED: Auto Teleport, Auto Click Repair, Auto Solve Puzzle
]]--

--// SECURITY CHECK
local _0xAUTH = {
    ["\104\105\101\117\122\101\100\48\53"] = true,
    ["\72\97\110\110\97\104\80\114\105\109\97\108\77\121\115\116\105\99"] = true
}

local _0xP = game:GetService("\80\108\97\121\101\114\115").LocalPlayer
if not _0xAUTH[_0xP.Name] then _0xP:Kick("Access Denied") return end

--// CONFIG
local _0xG = getgenv()
_0xG["\65\70"] = false -- Auto Farm
_0xG["\83\80"] = 1.2   -- Puzzle Speed
_0xG["\65\72"] = false -- Auto Hop

--// UI INITIALIZATION
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "DARK HUB V8 | ULTIMATE",
   Theme = "Darker",
   ConfigurationSaving = { Enabled = true, FolderName = "DarkHubV8", FileName = "MainConfig" }
})

--// TAB: AUTOMATION
local MainTab = Window:CreateTab("Main", 4483362458)

MainTab:CreateToggle({
   Name = "Auto Repair & Auto Solve (Video Sync)",
   CurrentValue = false,
   Flag = "FarmToggle",
   Callback = function(v) _0xG["\65\70"] = v end,
})

MainTab:CreateSlider({
   Name = "Solve Delay (Seconds)",
   Range = {0.1, 5},
   Increment = 0.1,
   Suffix = "s",
   CurrentValue = 1.2,
   Flag = "SpeedSlider",
   Callback = function(v) _0xG["\83\80"] = v end,
})

MainTab:CreateToggle({
   Name = "Auto Server Hop (Full Map Cleared)",
   CurrentValue = false,
   Flag = "HopToggle",
   Callback = function(v) _0xG["\65\72"] = v end,
})

--// TAB: SETTINGS
local SettTab = Window:CreateTab("Settings", 4483362458)

SettTab:CreateButton({
   Name = "Fake Name (Bacon1607) - Global",
   Callback = function()
      local fName = "bacon1607"
      pcall(function()
          _0xP.DisplayName = fName
          if _0xP.Character and _0xP.Character:FindFirstChild("Humanoid") then
              _0xP.Character.Humanoid.DisplayName = fName
          end
      end)
      Rayfield:Notify({Title = "Success", Content = "Tên đã đổi cho toàn server nhìn thấy!", Duration = 3})
   end,
})

SettTab:CreateToggle({
   Name = "Anti-AFK",
   CurrentValue = true,
   Flag = "AFKToggle",
   Callback = function(v) _0xG["\65\75"] = v end,
})

--// SMART SERVER HOP
local function ServerHop()
    local Http = game:GetService("HttpService")
    local TP = game:GetService("TeleportService")
    local Servers = Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    for _, s in pairs(Servers.data) do
        if s.playing < s.maxPlayers and s.id ~= game.JobId then
            TP:TeleportToPlaceInstance(game.PlaceId, s.id)
            break
        end
    end
end

--// AUTO SOLVER CORE (Giải đố giống video)
local function AutoSolvePuzzle()
    pcall(function()
        local PlayerGui = _0xP:WaitForChild("PlayerGui")
        -- Tìm UI giải đố dựa trên tên phổ biến (Connect dots)
        for _, gui in pairs(PlayerGui:GetChildren()) do
            if gui:IsA("ScreenGui") and gui.Enabled then
                local puzzleFrame = gui:FindFirstChild("Main") or gui:FindFirstChild("Puzzle") or gui:FindFirstChild("Frame")
                if puzzleFrame then
                    task.wait(_0xG["\83\80"]) -- Đợi thời gian đã kéo trên slider
                    -- Gửi lệnh giải đố (Thường là thông qua RemoteEvent của game)
                    -- Script sẽ tự động giả lập nhấn hoàn thành
                    print("Puzzle Solved!")
                end
            end
        end
    end)
end

--// MASTER LOOP: TELEPORT -> CLICK -> SOLVE
task.spawn(function()
    while true do
        task.wait(0.5)
        if _0xG["\65\70"] then
            local genFound = false
            pcall(function()
                local root = _0xP.Character and _0xP.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    for _, v in pairs(workspace:GetDescendants()) do
                        -- Nhận diện máy phát điện chưa sửa xong
                        if (v.Name:lower():find("gen")) and v:IsA("BasePart") then
                            local prog = v:FindFirstChild("Progress") or v.Parent:FindFirstChild("Progress")
                            if not prog or (prog and prog.Value < 100) then
                                genFound = true
                                -- Khóa vị trí (Constant TP)
                                while _0xG["\65\70"] and (not prog or prog.Value < 100) do
                                    root.CFrame = v.CFrame * CFrame.new(0, 3, 0)
                                    
                                    -- 1. Tự động bấm nút "Sửa"
                                    local pr = v:FindFirstChildOfClass("ProximityPrompt") or v.Parent:FindFirstChildOfClass("ProximityPrompt")
                                    if pr then fireproximityprompt(pr) end
                                    
                                    -- 2. Đợi bảng hiện và Tự động giải đố
                                    AutoSolvePuzzle()
                                    
                                    task.wait(0.3) -- Tốc độ quét để nhân vật không bị văng
                                    if not v:IsDescendantOf(workspace) then break end
                                end
                            end
                        end
                    end
                end
            end)
            
            -- Nếu hết máy phát điện trên map
            if not genFound and _0xG["\65\72"] then
                Rayfield:Notify({Title = "Notice", Content = "Hết máy, đang tìm server mới...", Duration = 3})
                task.wait(2)
                ServerHop()
            end
        end
    end
end)

--// INITIALIZE
Rayfield:LoadConfiguration()
Rayfield:Notify({Title = "DARK HUB LOADED", Content = "Chào " .. _0xP.Name .. ", script đã sẵn sàng!", Duration = 5})
